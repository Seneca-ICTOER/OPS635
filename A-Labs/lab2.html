<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-A-Labs/lab2">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="icon" href="/OPS635/img/pwa/icon-512x512.png">
<link rel="manifest" href="/OPS635/manifest.json">
<meta name="theme-color" content="#DA291C">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#DA291C">
<link rel="apple-touch-icon" href="/OPS635/img/pwa/icon-192x192.png">
<link rel="mask-icon" href="/OPS635/img/pwa/icon-512x512.png" color="#DA291C">
<meta name="msapplication-TileImage" content="/OPS635/img/pwa/icon-512x512.png">
<meta name="msapplication-TileColor" content="#DA291C">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Lab 2 | OPS635 - Enterprise Network Management - Emerging Technology</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Seneca-ICTOER.github.io//OPS635/A-Labs/lab2"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 2 | OPS635 - Enterprise Network Management - Emerging Technology"><meta data-rh="true" name="description" content="Lab 2 For Students to Complete and Submit"><meta data-rh="true" property="og:description" content="Lab 2 For Students to Complete and Submit"><link data-rh="true" rel="icon" href="/OPS635/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Seneca-ICTOER.github.io//OPS635/A-Labs/lab2"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OPS635/A-Labs/lab2" hreflang="en"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OPS635/A-Labs/lab2" hreflang="x-default"><link rel="stylesheet" href="/OPS635/assets/css/styles.099fe1a9.css">
<link rel="preload" href="/OPS635/assets/js/runtime~main.985de9ad.js" as="script">
<link rel="preload" href="/OPS635/assets/js/main.d5cc9ba2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/OPS635/"><div class="navbar__logo"><img src="/OPS635/img/logo.svg" alt="Seneca College" class="themedImage_ToTc themedImage--light_HNdA"><img src="/OPS635/img/logo-dark.svg" alt="Seneca College" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OPS635 - Enterprise Network Management - Emerging Technology</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OPS635/">Welcome to OPS635</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OPS635/weekly-schedule">Weekly Schedule</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/OPS635/A-Labs/prelab">Labs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS635/A-Labs/prelab">Prelab 0 - Host installation and virtual network setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS635/A-Labs/lab1">Lab 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/OPS635/A-Labs/lab2">Lab 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS635/A-Labs/lab3">Lab 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS635/A-Labs/lab4">Lab 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS635/A-Labs/lab5">Lab 5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS635/A-Labs/lab6">Lab 6</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OPS635/B-Assignments/assignment1">Assignments</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OPS635/C-ExtraResources/docker-installation-instructions">Extra Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/OPS635/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Labs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 2</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 2: Nagios Installation and Configuration</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>In an enterprise environment, a production server must be staged before deployment. Any upgrade to the production servers must be tested in a testing environment and signed off by the change manager(s) before deploying to the production environment. In this lab, you will install and configure the Nagios monitoring framework on a VM running on your testing environment before deploying it to the production environment. You will use many of the common definitions encountered in a typical nagios installation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-1-minimal-nagios-resources">Investigation 1: Minimal Nagios Resources<a class="hash-link" href="#investigation-1-minimal-nagios-resources" title="Direct link to heading">​</a></h2><p>Clone your existing VM. Call the new VM nagios.&lt;yourdomain<!-- -->&gt;<!-- -->.ops, and provide it a static address of your choice.</p><ul><li><p>Add the necessary records for this machine to your DNS server.</p></li><li><p><a href="/OPS635/C-ExtraResources/installation-nagios">Install and configure Nagios</a> on this machine.</p></li><li><p>Configure your Nagios to also use any definitions you include in a file called lab.cfg.</p></li><li><p>Using the lab.cfg file, create definitions to get your nagios installation to monitor the following hosts/services:</p><ul><li>Create a host definition to make the nagios machine monitor itself (using a non-loopback address). It should use the check<!-- -->_<!-- -->ping command every ten minutes to make sure it is active.</li><li>Create a service definition to make the nagios machine monitor whether it can connect to it&#x27;s own ssh service (using the non-loopback address). It should use the pre-written check<!-- -->_<!-- -->ssh command every 30 minutes, re-checking every 10 minutes if the initial check fails.</li><li>Create a timeperiod definition, and set it to only include the days and times you are in OPS635. Modify the definitions in lab.cfg to only run during this time.</li></ul></li><li><p>Make sure the webservice running on your nagios machine is accessible from your host machine.</p></li><li><p>Access the nagios web console and confirm that these checks are working before continuing.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-2-nagios-notifications">Investigation 2: Nagios Notifications<a class="hash-link" href="#investigation-2-nagios-notifications" title="Direct link to heading">​</a></h2><ul><li>Turn flap detection off for the checks you created in investigation 1.</li><li>Modify the lab.cfg file to include a contact named after yourself, using your email address in your domain. Set its notification periods to use the same timeperiod you created in investigation 1.</li><li>Create a second contact called senioradmin, using the email account for root@&lt;yourdomain<!-- -->&gt;<!-- -->.ops.</li><li>Set the notification interval for the host and service you created in investigation 1 to five minutes. This is unreasonably short for most installations, but in this lab we want to get multiple notifications in a very short time line so that we can be sure they are working.</li><li>If either of these services go into a hard-fail state, nagios should now send you an email. Note that you should already have configured the email server on your host to accept email for your domain.</li><li>Manipulate you machine to cause these checks to fail (e.g. set your firewall to block ssh traffic), and make sure you receive the email before continuing.</li><li>Fix your machine so the checks are passing again.</li><li>Add a hostescalation and a serviceescalation so that if you don&#x27;t fix the issue before you are notified three times, the notification will instead be sent to the senior admin.</li><li>Cause the checks to fail again, and wait for the notification to be sent to root.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-3-nagios-custom-commands">Investigation 3: Nagios Custom Commands<a class="hash-link" href="#investigation-3-nagios-custom-commands" title="Direct link to heading">​</a></h2><ul><li>Create a script plugin called check<!-- -->_<!-- -->sshd that will use systemctl to check the state of your sshd service. If the service is running, return 0. If it is inactive, return 1. If it is failed, return 2. For any other result return 3.</li><li>Create a command definition called check<!-- -->_<!-- -->sshd<!-- -->_<!-- -->status that will call the check<!-- -->_<!-- -->sshd plugin.</li><li>Create a new service definition that will use the new command to check the status of your sshd service every two minutes, going into a hard-fail state on the third failed check.</li><li>Create an event handler script to restart sshd if it is inactive. Use the nagios macros to make sure it only tries to restart the service on the second failed check (that is, before it goes into a hard-fail state).</li><li>Add notifications similar to those for your other checks (you should be notified if the service goes into a hard-fail state, and the senior admin should be notified if you don&#x27;t fix it).</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-4-nagios-remote-commands">Investigation 4: Nagios Remote Commands<a class="hash-link" href="#investigation-4-nagios-remote-commands" title="Direct link to heading">​</a></h2><ul><li>Clone your existing VM again. Call the new VM nagiosnrpe.&lt;yourdomain<!-- -->&gt;<!-- -->.ops, provide it a static address of your choice, and add it to your DNS server.</li><li>Install NRPE on nagiosnrpe.</li><li>Make sure to modify the NRPE configuration on nagiosnrpe to allow your nagios server to contact it.</li><li>Copy your check_sshd plugin to nagiosnrpe, making sure the user account for nrpe can run it. Note you will have to negotiate this with sudo and selinux.</li><li>Add a command to your nrpe configuration to allow remote execution of check<!-- -->_<!-- -->sshd.</li><li>Start and enable the service, and allow traffic to it through your firewall.</li><li>Back on your nagios server, add a new host definition for nagiosnrpe, and add a service that uses nrpe to run the check_sshd plugin on nagiosnrpe.</li><li>Ensure that the check runs correctly, then do something to intentionally make it fail (e.g. stop the sshd service), and ensure that that gets recorded too.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="submission">Submission<a class="hash-link" href="#submission" title="Direct link to heading">​</a></h2><p>Upload your lab.cfg, the nagios configuration from nagiosnrpe, your check<!-- -->_<!-- -->sshd plugin, and your event handler to blackboard.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="completing-the-lab">Completing The Lab<a class="hash-link" href="#completing-the-lab" title="Direct link to heading">​</a></h2><p>You have now gained experience using common elements of nagios to monitor machines in your network. You have configured hosts that should be monitored, identified services to monitor on them, created contacts and notifications so that administrators will be notified when things to wrong (and senior admins can be notified if they don&#x27;t get fixed), and used nrpe to allow checks to be performed remotely. You have also written simple checks to customize what you want monitored, and event handlers so that nagios can try to repair simple issues for you. There is still more to learn (host and service groups and dependencies will make your configuration much more efficient), but there is only so much room in the course. With what we have covered you have the basic building blocks to monitor your network.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Seneca-ICTOER/OPS635/tree/main/docs/A-Labs/lab2.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/OPS635/A-Labs/lab1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab 1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/OPS635/A-Labs/lab3"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 3</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#investigation-1-minimal-nagios-resources" class="table-of-contents__link toc-highlight">Investigation 1: Minimal Nagios Resources</a></li><li><a href="#investigation-2-nagios-notifications" class="table-of-contents__link toc-highlight">Investigation 2: Nagios Notifications</a></li><li><a href="#investigation-3-nagios-custom-commands" class="table-of-contents__link toc-highlight">Investigation 3: Nagios Custom Commands</a></li><li><a href="#investigation-4-nagios-remote-commands" class="table-of-contents__link toc-highlight">Investigation 4: Nagios Remote Commands</a></li><li><a href="#submission" class="table-of-contents__link toc-highlight">Submission</a></li><li><a href="#completing-the-lab" class="table-of-contents__link toc-highlight">Completing The Lab</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">OPS635 - Enterprise Network Management - Emerging Technology</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/OPS635/">Contents</a></li><li class="footer__item"><a href="#" id="pwa-button" class="footer__link-item" hidden>Install as an App</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Seneca College.</div></div></div></footer></div>
<script src="/OPS635/assets/js/runtime~main.985de9ad.js"></script>
<script src="/OPS635/assets/js/main.d5cc9ba2.js"></script>
</body>
</html>